var o=(t=>(t.PRODUCTION="production",t.SANDBOX="sandbox",t))(o||{});var s=(e=>(e.ALL="*",e.ORDER_PLACED="orderPlaced",e.WIDGET_CONTINUE_BUTTON_CLICKED="widgetContinueButtonClicked",e))(s||{});var p=(t=>(t.DARK="dark",t.LIGHT="light",t))(p||{});var r=(e=>(e.PRODUCTION="https://app.topperpay.com",e.SANDBOX="http://localhost:3000",e.WEBSITE="https://www.topperpay.com/",e))(r||{});var a=(e=>(e.IFRAME="iframe",e.NEW_TAB="new-tab",e.SAME_TAB="same-tab",e))(a||{});import h from"query-string";var l="@topper-web-sdk",d=class{eventHandlers={};handleMessage=null;isInitialized=!1;targetWindow=null;config;constructor(i={}){this.config={environment:"production",is_android_app:!1,is_ios_app:!1,variant:"new-tab",...i}}static triggerEvent(i,t){let e=window.self!==window.top?window.parent:window.opener;e&&e.postMessage({name:i,payload:t,source:l},"*")}triggerEvent(i,t){this.eventHandlers["*"]?.forEach(e=>e({data:t,name:i})),this.eventHandlers[i]?.forEach(e=>e({data:t}))}setConfig(i){this.config={...this.config,...i}}initializeMessageListener(){this.handleMessage=i=>{!["https://app.topperpay.com","http://localhost:3000"].includes(i.origin)||i.source!==this.targetWindow||i.data.name&&i.data.source===l&&this.triggerEvent(i.data.name,i.data.payload)},window.addEventListener("message",this.handleMessage)}dispose(){window.removeEventListener("message",this.handleMessage,!1),this.eventHandlers={}}initialize({bootstrapToken:i,config:t={},iframeElement:e}){if(this.isInitialized)throw new Error("This TopperWebSdk instance was already initialized.");this.isInitialized=!0,this.setConfig(t);let f=this.config.environment==="sandbox"?"http://localhost:3000":"https://app.topperpay.com",E=window.location.href.includes("https://www.topperpay.com/"),g={bt:i,...E&&{embed:1},...this.config.theme&&{theme:this.config.theme},...this.config.is_android_app&&{is_android_app:1},...this.config.is_ios_app&&{is_ios_app:1}},n=h.stringifyUrl({query:g,url:`${f}/`});if(this.config.variant==="iframe"){if(!e)throw new Error("iframeElement is required for iframe variant");e.src=n,this.targetWindow=e.contentWindow}else if(this.config.variant==="new-tab")this.targetWindow=window.open(n,"_blank");else if(this.config.variant==="same-tab"){window.location.href=n;return}this.initializeMessageListener()}on(i,t){this.eventHandlers[i]||(this.eventHandlers[i]=[]),this.eventHandlers[i]?.push(t)}};export{o as TOPPER_ENVIRONMENTS,s as TOPPER_EVENTS,p as TOPPER_THEMES,r as TOPPER_URLS,a as TOPPER_VARIANTS,d as TopperWebSdk};
//# sourceMappingURL=index.js.map