"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; } var _class;var o=(t=>(t.PRODUCTION="production",t.SANDBOX="sandbox",t))(o||{});var s=(e=>(e.ALL="*",e.ORDER_PLACED="orderPlaced",e.WIDGET_CONTINUE_BUTTON_CLICKED="widgetContinueButtonClicked",e))(s||{});var p=(t=>(t.DARK="dark",t.LIGHT="light",t))(p||{});var r=(e=>(e.PRODUCTION="https://app.topperpay.com",e.SANDBOX="http://localhost:3000",e.WEBSITE="https://www.topperpay.com/",e))(r||{});var a=(e=>(e.IFRAME="iframe",e.NEW_TAB="new-tab",e.SAME_TAB="same-tab",e))(a||{});var _querystring = require('query-string'); var _querystring2 = _interopRequireDefault(_querystring);var l="@topper-web-sdk",d= exports.TopperWebSdk = (_class =class{__init() {this.eventHandlers={}}__init2() {this.handleMessage=null}__init3() {this.isInitialized=!1}__init4() {this.targetWindow=null}constructor(i={}){;_class.prototype.__init.call(this);_class.prototype.__init2.call(this);_class.prototype.__init3.call(this);_class.prototype.__init4.call(this);this.config={environment:"production",is_android_app:!1,is_ios_app:!1,variant:"new-tab",...i}}static triggerEvent(i,t){let e=window.self!==window.top?window.parent:window.opener;e&&e.postMessage({name:i,payload:t,source:l},"*")}triggerEvent(i,t){_optionalChain([this, 'access', _ => _.eventHandlers, 'access', _2 => _2["*"], 'optionalAccess', _3 => _3.forEach, 'call', _4 => _4(e=>e({data:t,name:i}))]),_optionalChain([this, 'access', _5 => _5.eventHandlers, 'access', _6 => _6[i], 'optionalAccess', _7 => _7.forEach, 'call', _8 => _8(e=>e({data:t}))])}setConfig(i){this.config={...this.config,...i}}initializeMessageListener(){this.handleMessage=i=>{!["https://app.topperpay.com","http://localhost:3000"].includes(i.origin)||i.source!==this.targetWindow||i.data.name&&i.data.source===l&&this.triggerEvent(i.data.name,i.data.payload)},window.addEventListener("message",this.handleMessage)}dispose(){window.removeEventListener("message",this.handleMessage,!1),this.eventHandlers={}}initialize({bootstrapToken:i,config:t={},iframeElement:e}){if(this.isInitialized)throw new Error("This TopperWebSdk instance was already initialized.");this.isInitialized=!0,this.setConfig(t);let f=this.config.environment==="sandbox"?"http://localhost:3000":"https://app.topperpay.com",E=window.location.href.includes("https://www.topperpay.com/"),g={bt:i,...E&&{embed:1},...this.config.theme&&{theme:this.config.theme},...this.config.is_android_app&&{is_android_app:1},...this.config.is_ios_app&&{is_ios_app:1}},n=_querystring2.default.stringifyUrl({query:g,url:`${f}/`});if(this.config.variant==="iframe"){if(!e)throw new Error("iframeElement is required for iframe variant");e.src=n,this.targetWindow=e.contentWindow}else if(this.config.variant==="new-tab")this.targetWindow=window.open(n,"_blank");else if(this.config.variant==="same-tab"){window.location.href=n;return}this.initializeMessageListener()}on(i,t){this.eventHandlers[i]||(this.eventHandlers[i]=[]),_optionalChain([this, 'access', _9 => _9.eventHandlers, 'access', _10 => _10[i], 'optionalAccess', _11 => _11.push, 'call', _12 => _12(t)])}}, _class);exports.TOPPER_ENVIRONMENTS = o; exports.TOPPER_EVENTS = s; exports.TOPPER_THEMES = p; exports.TOPPER_URLS = r; exports.TOPPER_VARIANTS = a; exports.TopperWebSdk = d;
//# sourceMappingURL=index.cjs.map